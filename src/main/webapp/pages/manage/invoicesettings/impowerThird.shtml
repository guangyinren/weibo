<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta name="description" content="微票通_电子发票开具服务平台" />
    <meta name="keywords" content="微票通 票通 票通信息 电子发票 电子发票开具 电子发票开具平台 电子发票开具服务平台" />
    <meta name="renderer" content="webkit"/><meta http-equiv="x-ua-compatible" content="ie=8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>授权第三方开票</title>
	<link rel="stylesheet" href="/css/bootstrap3.3.6.min.css">
    <!--<link rel="stylesheet" href="/js/bootstrap/main/css/bootstrap.min.css">-->
    <link href="/css/common.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/manage/recharge.css">
    <link rel="stylesheet" href="/css/manage/invoiceAuthItem.css">
    <link href="/fonts/font-awesome.min.css" rel="stylesheet" type="text/css"  />
</head>
<body>
<style>
	.charge-title {
	    text-align-last: justify;
	    width: 120px;
	    display: inline-block;
	}
	a{
		cursor:pointer;
		color:#1a92c5;
	}
</style>
<div class="recharge-manage">
    <div class="body-title">
        授权第三方开票
    </div>
         <div class="account-balance">
            <div class="balance-tips">
                	消费者购买本企业商品（服务），使用第三方平台（工具）进行购买或者支付，在支付完成后，直接在第三方平台选择开具电子发票。本功能用于授权消费者在第三方平台自行开具电子发票。
            </div>
        </div>
    <div class="record-list">
        <div class="tabs clearfix">
            <div class="active">
                授权支付宝开票
            </div>
     <!--        <div>
                授权微信开票
            </div>
            <div>
                授权银联开票
            </div> -->
        </div>
        <div class="tables">
        	<div class="checkbox checkbox-primary">
                <input id="checkbox2" type="checkbox">
                <label for="checkbox2">	
                    我已认真阅读协议，并同意接受<a href="agreement.html" style="color: #0066CC;" target="_blank">《授权第三方开票协议》</a>
                </label>
            </div>
            <div style="font-size: 16px;">
            	<span style="vertical-align: middle;">支付宝（允许通过支付宝支付完成后开票）</span>
            	<div class="switch" style="display: inline-block;vertical-align: middle;margin-top: 3px;">
                    <div class="onoffswitch">
                        <input type="checkbox" class="onoffswitch-checkbox" id="example1">
                        <label class="onoffswitch-label" for="example1" id="zfb_check" style="margin-bottom:0">
                            <span class="onoffswitch-inner"></span>
                            <span class="onoffswitch-switch"></span>
                        </label>
                    </div>
                </div>
            </div>
            <div id="tabList" style="display: none;">
	            <div class="out-btns" align="right">
					<button type="button" id="dy" class="blue-btn" onclick="inserZFB();">新增绑定</button>
				</div>
	            <div class="recharge-table">
		            
	                <table>
	                   <thead>
							<tr id="addAlipay">
		                        <th>序号</th>
		                        <th>支付宝商户标识</th>
		                        <th>绑定时间</th>
		                        <th>品牌全称</th>
		                        <th>商户门店全称</th>
		                        <th>操作</th>
		                    </tr>
	                  </thead>
	                   <tbody id="alipays_query"></tbody>
	                </table>
	                   <!-- <tr>
							<td>1</td>
							<td>960</td>
							<td>2016-12-14 19:48:43</td>
							<td><a href="javascript:void(0)" onclick="unbind()">解除绑定</a></td>
						</tr>
	                   	<tr>
							<td>2</td>
							<td>960</td>
							<td>2016-12-14 19:48:43</td>
							<td><a href="javascript:void(0)" onclick="unbind()">解除绑定</a></td>
						</tr>
						<tr>
							<td>3</td>
							<td>960</td>
							<td>2016-12-14 19:48:43</td>
							<td><a href="javascript:void(0)" onclick="unbind()">解除绑定</a></td>
						</tr>
						<tr>
							<td>4</td>
							<td>960</td>
							<td>2016-12-14 19:48:43</td>
							<td><a href="javascript:void(0)" onclick="unbind()">解除绑定</a></td>
						</tr>
						<tr>
							<td>5</td>
							<td>960</td>
							<td>2016-12-14 19:48:43</td>
							<td><a href="javascript:void(0)" onclick="unbind()">解除绑定</a></td>
						</tr>
						<tr>
							<td>6</td>
							<td>960</td>
							<td>2016-12-14 19:48:43</td>
							<td><a href="javascript:void(0)" onclick="unbind()">解除绑定</a></td>
						</tr>
						<tr>
							<td>7</td>
							<td>960</td>
							<td>2016-12-14 19:48:43</td>
							<td><a href="javascript:void(0)" onclick="unbind()">解除绑定</a></td>
						</tr> -->
	                <div id="alertBD" class="alert_msg">
	                	<p style="margin-top: 50px;">当前没有绑定账号</p>
						<p>需要绑定商户标识后，消费者付款到该账号后才可以自行开票。<a href="javascript:void(0)" style="color: #0066cc;">立即绑定</a></p>
	                </div>
	            </div>
            </div>
        </div>
    </div>
 	<div id="page1" style="text-align:center;margin-top: 20px;"></div>
</div>
<div id="insertForm" style="display: none;" class="insert_form">
	<form id="addAlipayForm" novalidate="novalidate">
        <div class="charge-items">
            <div class="charge-item ">
                <span class="charge-title">支付宝商户标识：</span>
                <input class="charge-input" type="text" id="merchantId" name="merchantId" placeholder="请输入支付宝商户标识" aria-required="true" aria-invalid="true" style="display: inline-block;" onpaste="alert('为保证输入支付宝商户标识的正确性，请勿粘贴');return false">
                <img class="error-pic" src="../../../images/warn.png">
                <span class="error-text" id="merchantId_tip"></span>
            </div>
            <div class="charge-item ">
                <span class="charge-title" >确认商户标识：</span>
                <input class="charge-input" type="text" id="merchantId1" name="merchantId1" placeholder="请再次输入支付宝商户标识" aria-required="true" aria-invalid="true" style="display: inline-block;" onpaste="alert('为保证输入支付宝商户标识的正确性，请勿粘贴');return false">
                <img class="error-pic" src="../../../images/warn.png">
                <span class="error-text" id="merchantId1_tip"></span>
            </div>
            <div class="charge-item ">
                <span class="charge-title">品牌全称：</span>
                <input class="charge-input" type="text" id="mName" name="mName" placeholder="请输入品牌全称" aria-required="true" aria-invalid="true" style="display: inline-block;">
                <img class="error-pic" src="../../../images/warn.png">
                <span class="error-text" id="mName_tip"></span>
            </div>
            <div class="charge-item ">
                <span class="charge-title">商户门店全称：</span>
                <input class="charge-input" type="text" id="subMName" name="subMName" placeholder="请输入商户门店全称" aria-required="true" aria-invalid="true" style="display: inline-block;">
                <img class="error-pic" src="../../../images/warn.png">
                <span class="error-text" id="subMName_tip"></span>
            </div>
        </div>
    </form>
</div>
</body>
<script src="/js/jquery/1.8.3/jquery-1.8.3.min.js"></script>
<script src="/js/bootstrap/plugin/bootpag/js/jquery.bootpag.min.js"></script>
<script src="/js/jquery/validation/jquery.validate.min.js"></script>
<script src="/js/jquery/validation/additional-methods.js"></script>
<script src="/js/jquery/validation/localization/messages_zh.min.js"></script>
<script src="/js/layer.js"></script>
<script src="/js/lib/vpiaotong.base.js"></script>
<script src="/js/lib/vpiaotong.http.js"></script>
<script src="/js/lib/vpiaotong.pagewrapper.js"></script>
<script src="/js/views/manage/invoicesettings/impowerThirdCommon.js"></script>
<script src="/js/views/manage/invoicesettings/impowerThird.js"></script>
<script>
	var count = 0;
	function initCheckColor(){
		$("#checkbox2").prop("checked") ? $("#zfb_check,.onoffswitch-switch").css("border-color","rgb(63, 174, 220)") : $("#zfb_check,.onoffswitch-switch").css("border-color","#888");
	}
    $(function () {
    	initCheckColor();
    	$("#checkbox2").on("click",function(e){
    		if($("#example1").prop("checked")){
    			window.event? window.event.returnValue = false : e.preventDefault();
    		}
    		initCheckColor();
    	})
    	$("#zfb_check").on("click",function(e){
    		if(! $("#checkbox2").prop("checked")){
    			window.event? window.event.returnValue = false : e.preventDefault();
    		}
    	})
    	
    	$("#example1").on("click",function(e){
    		if($("#example1").prop("checked")){
    			$("#tabList").show();
    		}else{
    			if(count > 0){
	 	      		  if ( e && e.preventDefault ) {
	 	 		         e.preventDefault();
	 	 		     } else {
	 	 		        window.event.returnValue = false;
	 	 		    }
    				layer.confirm("<p style='font-size:18px;margin-top: 20px;font-weight: 600;'><i class=\"layui-layer-ico layui-layer-ico0\" style='background: url(../../../images/warning.jpg) no-repeat;width: 50px;height: 37px;position:static;vertical-align: middle;'></i>确定要解绑吗？</p><p style='font-size:14px;'>关闭该功能后，付款到该平台的消费者将无法自行开票，同时将清空您全部的绑定账号，确定要关闭？</p>", {
        				icon: -1, title:['&nbsp;'],btn: ['确 定','取 消'],btnAlign: 'c',area: 'auto',maxWidth:450 //按钮
        			}, function(){
        				layer.closeAll();
        				layer.confirm("<p style='font-size:18px;margin-top: 20px;font-weight: 600;'><i class=\"layui-layer-ico layui-layer-ico0\" style='background: url(../../../images/warning.jpg) no-repeat;width: 50px;height: 37px;position:static;vertical-align: middle;'></i>再次确认</p><p style='font-size:14px;'>确定关闭该功能？</p>", {
    	        				icon: -1, title:['&nbsp;'],btn: ['确 定','取 消'],btnAlign: 'c',area: 'auto',maxWidth:450 //按钮
    	        			}, function(){
    	        				$http.post(basePath+"authorizationManager/delAllAlipay"+suffix,"",
    	        						function(data) {
    	        							console.info(data);
    	        							if(data.code=="200"||data.code=="201"){
    	        								count = 0;
    	        								layer.closeAll();
    	        								$("#example1").attr("checked",false);
    	        								$("#example1").prop("checked",false);
    	        				    			$("#tabList").hide();
    	        				    			$("#page1").hide();
    	        								$("#alipays_query").empty();
    	        								$("#alipays_query").html("<td colspan='6' style='text-align: center;'>暂无数据</td>");
    	        								$("#page1").empty();
    	        							}
    	        				});
    	        			}, function(){
    	        				layer.close();
    	        		  });
        			}, function(){
        				layer.close();
        		  });
    			}else{
					$("#example1").attr("checked",false);
					$("#example1").prop("checked",false);
	    			$("#tabList").hide();
	    			$("#page1").hide();
					$("#alipays_query").empty();
					$("#alipays_query").html("<td colspan='6' style='text-align: center;'>暂无数据</td>");
					$("#page1").empty();
    			}
    		}
    	})
    		
        $("#alertBD").css("height",($(document).height() - 530) + 'px');
        $("#alertBD").css("padding-top",(($(document).height() - 530) / 2 - 80) + 'px');
        
         $(".tabs>div").click(function () {
            $(".tabs>div").removeClass("active");
            $(this).addClass("active");
        });
         queryAlipayssByIndex(1);
    });
    function inserZFB(){
		$("#merchantId").val(''),
		$("#mName").val(''),
		$("#subMName").val(''),
		$("#merchantId1").val('');
		$("#addAlipayForm .error").removeClass('error');
		$("#addAlipayForm").validate().resetForm();
    	layer.open({
    			id:'o1',
			  type: 1,
			  title:['支付宝账号', 'background: #394457;color:#fff'],
			  content: $('#insertForm'),
			  btn: ['确 定','取 消'],btnAlign: 'c',area: 'auto',maxWidth:600,
			  yes: function(index, layero){
				alipayAuthorization();
			  },btn2: function(index, layero){
			    layer.close();
			  }
		});     
    }
    
    function alertSuccess(){
    	$.ajax({
    		type: "GET",
    		url: basePath+"invoiceItem/queryInvoiceItemList"+suffix,
    		dataType: "json",
    		success: function(data) {
    			if ("200" == data.code) {
    				var rows = data.data.rows;
    				var total = data.data.total;
    				if(total>0){
    					layer.confirm("<p style='font-size:18px;margin-top: 20px;font-weight: 600;'><i class=\"layui-layer-ico layui-layer-ico0\" style='background: url(../../../images/suc.jpg) no-repeat;width: 50px;height: 37px;position:static;vertical-align: middle;'></i>确定成功</p><p style='font-size:14px;'>", {
    						icon: -1, title:['&nbsp;'],btn: ['确 定'],btnAlign: 'c',area: 'auto',maxWidth:450 //按钮
    					}, function(){
    						layer.closeAll();
    					});
    				}else{
    					layer.confirm("<p style='font-size:18px;margin-top: 20px;font-weight: 600;'><i class=\"layui-layer-ico layui-layer-ico0\" style='background: url(../../../images/suc.jpg) no-repeat;width: 50px;height: 37px;position:static;vertical-align: middle;'></i>确定成功</p><p style='font-size:14px;'>请前往<a style='color: #337ab7;' href=\"javascript:window.parent.addTab('开票项目管理','invoiceItem/invoiceItemQuery.shtml','icon-s7')\">“开票项目管理”</a>设置您的开票项目</p>", {
    						icon: -1, title:['&nbsp;'],btn: ['确 定'],btnAlign: 'c',area: 'auto',maxWidth:450 //按钮
    					}, function(){
    						layer.closeAll();
    					});
    				}
    			}
    			}
    		})
    	}
    	
    function switchCheck(sign){
    	console.log(sign);
    	if(sign){
    		$("#checkbox2").prop("checked", true);
    		$("#example1").prop("checked", true);
    		//$("#checkbox2").attr("checked", "checked");
    		//$("#example1").attr("checked", "checked");
			$("#tabList").show();
    	}else{
    		$("#checkbox2").prop("checked", false);
    		$("#example1").prop("checked", false);
			$("#tabList").hide();
			$("#page1").hide();
    	}
    }
//  	layer.confirm("确定要解除吗？<br />解除绑定后，付款到该支付宝账号的消费者将无法自行开票", {
//				icon: 0, title:'&nbsp;1',btn: ['确定','取消'] //按钮
//			}, function(index){
//				layer.close(index);
//			}, function(){
//				layer.close(index);
//	  	});
</script>
</html>